<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Interactive Flipbook</title>
    <!-- jQuery (with fallback) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        if (typeof jQuery === 'undefined') {
            // If jQuery fails to load from CDN, try local file
            document.write('<script src="js/jquery-3.6.0.min.js"><\/script>');
        }
    </script>
    <!-- Turn.js (with fallback) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    <script>
        if (typeof $.fn.turn === 'undefined') {
            // If Turn.js fails to load from CDN, try local file
            document.write('<script src="js/turn.min.js"><\/script>');
        }
    </script>
    <audio id="flipSound" src="images/page-flip-47177.mp3" preload="auto"></audio>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: 'Georgia', serif;
            padding: 20px;
            color: #fff;
            cursor: pointer;
            touch-action: manipulation;
        }

        .flipbook-container {
            width: 100%;
            max-width: 1000px;
            height: auto;
            margin: 20px auto;
            position: relative;
            background: #2a2a2a;
            box-shadow: 0 0 30px rgba(0,0,0,0.7);
            overflow: visible;
            border-radius: 10px;
            padding: 20px;
        }

        #book {
            width: 100%;
            height: auto;
            min-height: 400px;
        }

        .page {
            background: #fff;
            position: relative;
        }

        .page img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .hard {
            background: #2a2a2a;
            color: #fff;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            overflow: hidden;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.3);
            position: relative;
        }

        .hard.p1 {
            background: #1a1a1a;
            color: white;
        }

        .hard.p2 {
            background: #1a1a1a;
            color: white;
        }

        .hard img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            pointer-events: none;
        }

        .page-number {
            position: absolute;
            bottom: 10px;
            font-size: 12px;
            color: #666;
            padding: 5px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 3px;
        }

        .page-number.left {
            left: 15px;
        }

        .page-number.right {
            right: 15px;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            font-size: 24px;
            font-family: 'Georgia', serif;
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .flipbook-container {
                padding: 10px;
                margin: 10px auto;
            }

            #book {
                min-height: 300px;
            }

            .page {
                width: 50% !important; /* Force two pages side by side */
            }

            .page-number {
                font-size: 10px;
                padding: 3px;
            }
        }

        /* Touch feedback */
        .touch-feedback {
            position: fixed;
            pointer-events: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            animation: touch-feedback 0.3s ease-out forwards;
            z-index: 1000;
        }

        @keyframes touch-feedback {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="loading">Loading Flipbook...</div>
    
    <div class="flipbook-container">
        <div id="book">
            <div class="page">
                <img src="images\Artboard 28.jpg" alt="Page 1" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">1</div>
            </div>
            <div class="page">
                <img src="images/30-min.jpg" alt="Page 2" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">2</div>
            </div>
            <div class="page">
                <img src="images/31-min.jpg" alt="Page 3" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">3</div>
            </div>
            <div class="page">
                <img src="images/32-min.jpg" alt="Page 4" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">4</div>
            </div>
            <div class="page">
                <img src="images/33-min.jpg" alt="Page 5" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">5</div>
            </div>
            <div class="page">
                <img src="images/34-min.jpg" alt="Page 6" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">6</div>
            </div>
            <div class="page">
                <img src="images/35-min.jpg" alt="Page 7" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">7</div>
            </div>
            <div class="page">
                <img src="images/36-min.jpg" alt="Page 8" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">8</div>
            </div>
            <div class="page">
                <img src="images/38-min.jpg" alt="Page 9" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">9</div>
            </div>
            <div class="page">
                <img src="images/39-min.jpg" alt="Page 10" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">10</div>
            </div>
            <div class="page">
                <img src="images/40-min.jpg" alt="Page 11" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">11</div>
            </div>
            <div class="page">
                <img src="images/41-min.jpg" alt="Page 12" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">12</div>
            </div>
            <div class="page">
                <img src="images/42-min.jpg" alt="Page 13" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">13</div>
            </div>
            <div class="page">
                <img src="images/Artboard 1-min.jpg" alt="Page 14" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">14</div>
            </div>
            <div class="page">
                <img src="images/Artboard 4-min.jpg" alt="Page 15" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">15</div>
            </div>
            <div class="page">
                <img src="images/Artboard 6-min.jpg" alt="Page 16" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">16</div>
            </div>
            <div class="page">
                <img src="images/Artboard 7-min.jpg" alt="Page 17" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">17</div>
            </div>
            <div class="page">
                <img src="images/Artboard 9-min.jpg" alt="Page 18" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">18</div>
            </div>
            <div class="page">
                <img src="images/Artboard 12-min.jpg" alt="Page 19" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">19</div>
            </div>
            <div class="page">
                <img src="images/Artboard 13-min.jpg" alt="Page 20" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">20</div>
            </div>
            <div class="page">
                <img src="images/Artboard 14-min.jpg" alt="Page 21" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">21</div>
            </div>
            <div class="page">
                <img src="images/Artboard 15-min.jpg" alt="Page 22" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">22</div>
            </div>
            <div class="page">
                <img src="images/Artboard 16-min.jpg" alt="Page 23" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">23</div>
            </div>
            <div class="page">
                <img src="images/Artboard 17-min.jpg" alt="Page 24" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">24</div>
            </div>
            <div class="page">
                <img src="images/Artboard 19-min.jpg" alt="Page 25" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">25</div>
            </div>
            <div class="page">
                <img src="images/Artboard 20-min.jpg" alt="Page 26" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">26</div>
            </div>
            <div class="page">
                <img src="images/Artboard 23-min.jpg" alt="Page 27" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">27</div>
            </div>
            <div class="page">
                <img src="images/Artboard 24-min.jpg" alt="Page 28" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number left">28</div>
            </div>
            <div class="page">
                <img src="images/Artboard 26-min.jpg" alt="Page 29" style="width: 100%; height: 100%; object-fit: contain;">
                <div class="page-number right">29</div>
            </div>
            <div class="page">
                <img src="images/Artboard 27-min.jpg" alt="Back Cover" style="width: 100%; height: 100%; object-fit: cover;">
                <div class="page-number left">30</div>
            </div>
        </div>
    </div>

<script>
    function initializeBook() {
        const book = $("#book");
        const flipSound = document.getElementById('flipSound');
        let soundEnabled = true;
        let touchStartX = 0;
        let touchStartY = 0;
        const SWIPE_THRESHOLD = 50; // Minimum distance for swipe

        // Preload images in the book before initializing turn.js
        const images = book.find('img');
        let loadedImages = 0;
        const totalImages = images.length;

        images.each(function() {
            const img = new Image();
            img.onload = function() {
                loadedImages++;
                if (loadedImages === totalImages) {
                    $('.loading').fadeOut();
                    initializeTurn();
                }
            };
            img.onerror = function() {
                console.error('Failed to load image:', this.src);
                loadedImages++;
                if (loadedImages === totalImages) {
                    $('.loading').fadeOut();
                    initializeTurn();
                }
            };
            img.src = $(this).attr('src');
        });

        // Initialize the turn.js flipbook
        function initializeTurn() {
            let isTurning = false;

            try {
                book.turn({
                    width: Math.min(window.innerWidth - 40, 1000),
                    height: Math.min(window.innerHeight - 100, 700),
                    autoCenter: true,
                    display: window.innerWidth <= 768 ? 'single' : 'double', // Use single page on small screens
                    elevation: 50,
                    gradients: true,
                    duration: 1200,
                    when: {
                        turning: function(e, page, view) {
                            isTurning = true;
                            if (flipSound && soundEnabled) {
                                try {
                                    flipSound.currentTime = 0;
                                    const playPromise = flipSound.play();
                                    if (playPromise !== undefined) {
                                        playPromise.catch(error => {
                                            console.log('Sound play failed:', error);
                                        });
                                    }
                                } catch (e) {
                                    console.error('Sound error:', e);
                                }
                            }
                        },
                        turned: function(e, page, view) {
                            isTurning = false;
                            localStorage.setItem('currentPage', page);
                        }
                    }
                });

                // Restore saved page if any
                const savedPage = localStorage.getItem('currentPage');
                if (savedPage) {
                    book.turn('page', parseInt(savedPage));
                }

                // Touch start - track initial coordinates and give feedback
                book.on('touchstart', function(e) {
                    const touch = e.originalEvent.touches[0];
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;

                    // Optional: visual feedback on touch
                    const touchFeedback = $('<div class="touch-feedback"></div>');
                    touchFeedback.css({
                        left: touchStartX + 'px',
                        top: touchStartY + 'px'
                    });
                    $('body').append(touchFeedback);
                    setTimeout(() => touchFeedback.remove(), 300);
                });

                // Touch end - detect swipe direction and turn pages
                book.on('touchend', function(e) {
                    if (isTurning) return;

                    const touch = e.originalEvent.changedTouches[0];
                    const touchEndX = touch.clientX;
                    const touchEndY = touch.clientY;

                    const deltaX = touchEndX - touchStartX;
                    const deltaY = touchEndY - touchStartY;

                    // Horizontal swipe detection
                    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > SWIPE_THRESHOLD) {
                        if (deltaX > 0) {
                            book.turn('previous');
                        } else {
                            book.turn('next');
                        }
                    }
                });

                // Click navigation (desktop only, disable on touch devices)
                book.on('click', function(e) {
                    if (isTurning || 'ontouchstart' in window) return;

                    const bookWidth = book.width();
                    const clickX = e.pageX - book.offset().left;

                    if (clickX > bookWidth / 2) {
                        book.turn('next');
                    } else {
                        book.turn('previous');
                    }
                });

                // Keyboard arrow navigation for accessibility
                $(document).keydown(function(e) {
                    if (isTurning) return;
                    if (e.key === "ArrowRight") book.turn('next');
                    else if (e.key === "ArrowLeft") book.turn('previous');
                });

                // Handle window resize: adjust size and display mode
                let resizeTimer;
                $(window).on('resize', function() {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(function() {
                        const newWidth = Math.min(window.innerWidth - 40, 1000);
                        const newHeight = Math.min(window.innerHeight - 100, 700);
                        book.turn('size', newWidth, newHeight);

                        // Switch to single page on smaller screens
                        if (window.innerWidth <= 768) {
                            book.turn('display', 'single');
                        } else {
                            book.turn('display', 'double');
                        }
                    }, 250);
                });

                // Unlock sound playback on first interaction (required by some browsers)
                $(document).one('click touchstart', function() {
                    if (flipSound) {
                        flipSound.play().catch(e => console.log('Initial sound play failed:', e));
                    }
                });

            } catch (e) {
                console.error("Turn.js initialization error:", e);
                alert('Error initializing the flipbook. Please refresh the page and try again.');
            }
        }
    }

    // Initialize on window load
    $(window).on('load', function() {
        initializeBook();
    });
</script>
</body>
</html>
